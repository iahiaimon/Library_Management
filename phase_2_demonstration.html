<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 - Enhanced Form Handling with Backend Integration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .content {
            padding: 40px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        section {
            margin-bottom: 50px;
        }

        h2 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        h3 {
            color: #764ba2;
            margin-top: 20px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        h4 {
            color: #667eea;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .feature-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .feature-box strong {
            color: #667eea;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .code-block pre {
            margin: 0;
            padding: 0;
            background: transparent;
            overflow-x: auto;
            white-space: pre;
            word-wrap: normal;
        }

        .code-block code {
            background: transparent;
            color: #f8f8f2;
            padding: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.6;
            display: block;
            white-space: pre;
        }

        .code-title {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            margin: 20px 0 0 0;
            border-radius: 5px 5px 0 0;
            font-weight: bold;
        }

        .code-description {
            background: #e8f4f8;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .terminal-command {
            background: #2d2d2d;
            color: #00ff00;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            border-left: 4px solid #00ff00;
            cursor: pointer;
            transition: 0.3s;
        }

        .terminal-command:hover {
            background: #404040;
        }

        .learning-objective {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .learning-objective strong {
            color: #28a745;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        table tr:hover {
            background: #f5f5f5;
        }

        .tip-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .important-box {
            background: #ffe7e7;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .navigation {
            position: fixed;
            right: 20px;
            top: 100px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
            max-height: 70vh;
            overflow-y: auto;
        }

        .navigation a {
            display: block;
            color: #667eea;
            text-decoration: none;
            margin: 10px 0;
            font-weight: 500;
            transition: 0.3s;
            font-size: 0.9em;
        }

        .navigation a:hover {
            color: #764ba2;
            transform: translateX(10px);
        }

        @media (min-width: 1400px) {
            .navigation {
                display: block;
            }
        }

        .step-box {
            background: #f0f7ff;
            border: 2px solid #667eea;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-right: 10px;
        }

        .keyword {
            color: #f92672;
        }

        .string {
            color: #e6db74;
        }

        .comment {
            color: #75715e;
        }

        .flow-diagram {
            background: #f0f7ff;
            border: 2px solid #667eea;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre;
            overflow-x: auto;
        }

        .template-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .template-box strong {
            color: #ff6f00;
        }

        .backend-flow {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .backend-flow strong {
            color: #1565c0;
        }

        ul, ol {
            margin-left: 20px;
        }

        li {
            margin: 8px 0;
        }

        a {
            color: #667eea;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìù Phase 2: Enhanced Form Handling & Validation</h1>
            <p>Backend Integration & Advanced Template Explanations</p>
        </header>

        <div class="navigation">
            <a href="#overview">Overview</a>
            <a href="#whats-new">What's New</a>
            <a href="#backend-forms">Backend: Forms</a>
            <a href="#backend-views">Backend: Views</a>
            <a href="#validation">Validation</a>
            <a href="#templates">Templates</a>
            <a href="#data-flow">Data Flow</a>
            <a href="#commands">Commands</a>
            <a href="#testing">Testing</a>
            <a href="#comparison">Comparison</a>
        </div>

        <div class="content">
            <!-- OVERVIEW SECTION -->
            <section id="overview">
                <h2>üéØ Phase 2 Overview</h2>
                
                <div class="learning-objective">
                    <strong>What is Phase 2?</strong><br>
                    Phase 2 enhances Phase 1 with Django Forms (ModelForm) and advanced validation. Instead of manually handling POST data, we use Django Forms for automatic validation, error handling, and security. This phase teaches professional form handling patterns used in production applications.
                </div>

                <div class="backend-flow">
                    <strong>Phase 1 vs Phase 2:</strong>
                    <ul>
                        <li><strong>Phase 1:</strong> Manual form handling with request.POST.get()</li>
                        <li><strong>Phase 2:</strong> Django Forms (ModelForm) with built-in validation</li>
                        <li><strong>Phase 1:</strong> No validation on backend</li>
                        <li><strong>Phase 2:</strong> Field-level and form-level validation</li>
                        <li><strong>Phase 1:</strong> Manual error display</li>
                        <li><strong>Phase 2:</strong> Automatic error rendering in templates</li>
                    </ul>
                </div>

                <div class="important-box">
                    <strong>‚ö†Ô∏è Why Phase 2 Matters:</strong> Using Django Forms prevents common security issues, reduces code duplication, and makes form handling consistent across your application.
                </div>
            </section>

            <!-- WHAT'S NEW SECTION -->
            <section id="whats-new">
                <h2>‚ú® What's New in Phase 2</h2>

                <h3>1. ModelForm - Automatic Form Generation</h3>
                <div class="feature-box">
                    <strong>üéØ Benefit:</strong> Django automatically creates form fields based on your model. No need to manually define CharField, IntegerField, etc.
                </div>

                <h3>2. Built-in Validation</h3>
                <div class="feature-box">
                    <strong>üéØ Benefit:</strong> Validate data on the backend before saving to database. Prevent invalid data from ever reaching the database.
                </div>

                <h3>3. Error Handling & Display</h3>
                <div class="feature-box">
                    <strong>üéØ Benefit:</strong> Django automatically collects errors and makes them available in templates. Show users exactly what went wrong.
                </div>

                <h3>4. CSRF Protection</h3>
                <div class="feature-box">
                    <strong>üéØ Benefit:</strong> Form automatically includes CSRF token. Prevents malicious websites from submitting forms on user's behalf.
                </div>

                <h3>5. Edit Forms with Data Pre-filling</h3>
                <div class="feature-box">
                    <strong>üéØ Benefit:</strong> When editing, form automatically populates with current data from database. Same form works for create and edit!
                </div>
            </section>

            <!-- BACKEND FORMS SECTION -->
            <section id="backend-forms">
                <h2>üìã Backend: Django Forms (forms.py)</h2>

                <div class="backend-flow">
                    <strong>What Forms Do:</strong> Forms validate user input and protect against common attacks. They're the gateway between frontend and backend.
                </div>

                <h3>BookForm - ModelForm Version</h3>

                <div class="code-title">myapp/forms.py - BookForm with ModelForm</div>
                <div class="code-block"><pre><code><span class="keyword">from</span> django import forms
<span class="keyword">from</span> .models import Book

<span class="keyword">class</span> BookForm(forms.ModelForm):
    <span class="comment">"""
    Automatically creates form from Book model
    Django generates fields based on model definition
    """</span>
    
    <span class="comment"># Override title field - add custom widget</span>
    title = forms.CharField(
        max_length=200,
        widget=forms.TextInput(attrs={
            'class': 'form-control',  <span class="comment"># CSS class for styling</span>
            'placeholder': 'Enter book title',
            'required': True
        }),
        error_messages={
            'required': 'Title is required!',
            'max_length': 'Title too long (max 200 chars)'
        }
    )
    
    <span class="comment"># Override author field</span>
    author = forms.CharField(
        max_length=100,
        widget=forms.TextInput(attrs={
            'class': 'form-control',
            'placeholder': 'Enter author name'
        })
    )
    
    <span class="comment"># Override quantity field - use NumberInput widget</span>
    quantity = forms.IntegerField(
        min_value=1,  <span class="comment"># Cannot be less than 1</span>
        widget=forms.NumberInput(attrs={
            'class': 'form-control',
            'min': '1'
        }),
        error_messages={
            'min_value': 'Quantity must be at least 1'
        }
    )
    
    <span class="comment"># Description with nice textarea</span>
    description = forms.CharField(
        required=False,  <span class="comment"># Optional field</span>
        widget=forms.Textarea(attrs={
            'class': 'form-control',
            'rows': 4,
            'placeholder': 'Enter book description'
        })
    )
    
    <span class="comment"># Form metadata - which model and fields to use</span>
    <span class="keyword">class</span> Meta:
        model = Book  <span class="comment"># Link to Book model</span>
        fields = ['title', 'author', 'isbn', 
                  'quantity', 'publication_date', 'description']
        widgets = {
            <span class="comment\"># Date picker for publication_date</span>
            'publication_date': forms.DateInput(
                attrs={
                    'type': 'date',
                    'class': 'form-control'
                }
            ),
            <span class="comment\"># ISBN field</span>
            'isbn': forms.TextInput(attrs={
                'class': 'form-control',
                'maxlength': '13',
                'placeholder': '13-digit ISBN'
            })
        }
    
    <span class="comment\">\"\"\"
    FIELD-LEVEL VALIDATION
    Each clean_fieldname() method validates a single field
    \"\"\"</span>
    
    <span class=\"keyword\">def</span> clean_title(self):
        <span class=\"comment\"># Get cleaned title data</span>
        title = self.cleaned_data.get('title')
        
        <span class=\"comment\"># Check if title already exists</span>
        if title and Book.objects.filter(
            title=title
        ).exclude(
            pk=self.instance.pk  <span class=\"comment\"># Exclude current book when editing</span>
        ).exists():
            <span class=\"keyword\">raise</span> forms.ValidationError(
                'This book title already exists!'
            )
        <span class=\"keyword\">return</span> title
    
    <span class=\"keyword\">def</span> clean_isbn(self):
        <span class=\"comment\"># Validate ISBN format</span>
        isbn = self.cleaned_data.get('isbn')
        
        <span class=\"keyword\">if</span> isbn:
            <span class=\"comment\"># Check length</span>
            if len(isbn) != 13:
                <span class=\"keyword\">raise</span> forms.ValidationError(
                    'ISBN must be exactly 13 digits'
                )
            
            <span class=\"comment\"># Check if only numbers</span>
            if <span class=\"keyword\">not</span> isbn.isdigit():
                <span class=\"keyword\">raise</span> forms.ValidationError(
                    'ISBN must contain only numbers'
                )
            
            <span class=\"comment\"># Check if already exists</span>
            if Book.objects.filter(
                isbn=isbn
            ).exclude(
                pk=self.instance.pk
            ).exists():
                <span class=\"keyword\">raise</span> forms.ValidationError(
                    'This ISBN already registered'
                )
        
        <span class=\"keyword\">return</span> isbn
    
    <span class=\"keyword\">def</span> clean_quantity(self):
        <span class=\"comment\"># Validate quantity</span>
        quantity = self.cleaned_data.get('quantity')
        
        <span class=\"keyword\">if</span> quantity <span class=\"keyword\">and</span> quantity < 1:
            <span class=\"keyword\">raise</span> forms.ValidationError(
                'Quantity must be at least 1'
            )
        
        <span class=\"keyword\">return</span> quantity
    
    <span class=\"comment\">\"\"\"
    FORM-LEVEL VALIDATION
    clean() method validates relationships between fields
    \"\"\"</span>
    
    <span class=\"keyword\">def</span> clean(self):
        <span class=\"comment\"># Get all cleaned data</span>
        cleaned_data = super().clean()
        
        title = cleaned_data.get('title')
        author = cleaned_data.get('author')
        
        <span class=\"comment\"># Example: Both required</span>
        if title <span class=\"keyword\">and</span> <span class=\"keyword\">not</span> author:
            self.add_error('author', 
                'Author required when title provided')
        
        <span class=\"keyword\">return</span> cleaned_data</code></pre></div>

                <div class="code-description">
                    <strong>üìù Form Structure Breakdown:</strong>
                    <ul>
                        <li><code>ModelForm</code> - Automatically creates fields from model</li>
                        <li><code>Meta class</code> - Defines model and which fields to include</li>
                        <li><code>widgets</code> - HTML input types (TextInput, DateInput, etc.)</li>
                        <li><code>clean_fieldname()</code> - Validates individual fields</li>
                        <li><code>clean()</code> - Validates entire form (field relationships)</li>
                        <li><code>error_messages</code> - Custom error text for users</li>
                    </ul>
                </div>
            </section>

            <!-- BACKEND VIEWS SECTION -->
            <section id="backend-views">
                <h2>üé¨ Backend: Enhanced Views (views.py)</h2>

                <div class="backend-flow">
                    <strong>Phase 2 Views:</strong> Views now use Django Forms for validation. Much cleaner and more secure than manual request.POST handling!
                </div>

                <h3>Create Book with Form Validation</h3>

                <div class="code-title">myapp/views.py - create_book with Form</div>
                <div class="code-block"><pre><code><span class="keyword">from</span> django.shortcuts import render, redirect
<span class="keyword">from</span> django.contrib import messages
<span class="keyword">from</span> .forms import BookForm
<span class="keyword">from</span> .models import Book

<span class="keyword">def</span> create_book(request):
    <span class="comment">"""
    GET: Show empty form
    POST: Validate form and save to database
    """</span>
    
    <span class="keyword">if</span> request.method == 'POST':
        <span class="comment\"># Create form instance with POST data</span>
        form = BookForm(request.POST)
        
        <span class=\"comment\"># Form.is_valid() runs all validation</span>
        <span class=\"keyword\">if</span> form.is_valid():
            <span class=\"comment\"># All validation passed - save to database</span>
            book = form.save()  <span class=\"comment\"># Saves Book object and returns it</span>
            
            <span class=\"comment\"># Show success message to user</span>
            messages.success(request, 
                f'Book \"{book.title}\" added successfully!')
            
            <span class=\"comment\"># Redirect to book list</span>
            <span class=\"keyword\">return</span> redirect('myapp:book_list')
        <span class=\"keyword\">else:</span>
            <span class=\"comment\"># Validation failed - show errors in form</span>
            <span class=\"comment\"># form.errors automatically populated by Django</span>
            messages.error(request, 
                'Please fix the errors below')
    <span class=\"keyword\">else:</span>
        <span class=\"comment\"># GET request - create empty form</span>
        form = BookForm()
    
    <span class=\"comment\"># Pass form to template (empty or with errors)</span>
    context = {
        'form': form,
        'page_title': 'Add New Book'
    }
    
    <span class=\"keyword\">return</span> render(request, 'myapp/book_form.html', context)</code></pre></div>

                <div class="code-description">
                    <strong>üîÑ Form Validation Flow:</strong>
                    <ol>
                        <li>Form receives POST data: <code>form = BookForm(request.POST)</code></li>
                        <li><code>form.is_valid()</code> runs all validation methods</li>
                        <li>If valid: <code>form.save()</code> saves to database</li>
                        <li>If invalid: <code>form.errors</code> available in template</li>
                        <li>Template displays errors next to each field</li>
                    </ol>
                </div>

                <h3>Edit Book with Pre-filled Form</h3>

                <div class="code-title">myapp/views.py - edit_book with Form</div>
                <div class="code-block"><pre><code><span class="keyword">from</span> django.shortcuts import get_object_or_404

<span class="keyword">def</span> edit_book(request, pk):
    <span class="comment">"""
    GET: Show form pre-filled with current data
    POST: Validate and update database
    """</span>
    
    <span class="comment\"># Get existing book from database</span>
    book = get_object_or_404(Book, pk=pk)
    
    <span class=\"keyword\">if</span> request.method == 'POST':
        <span class=\"comment\"># Create form with POST data AND current book instance</span>
        form = BookForm(request.POST, instance=book)
        
        <span class=\"keyword\">if</span> form.is_valid():
            <span class=\"comment\"># Form saves to existing book (UPDATE, not INSERT)</span>
            form.save()
            
            messages.success(request,
                f'Book \"{book.title}\" updated!')
            <span class=\"keyword\">return</span> redirect('myapp:book_detail', pk=book.pk)
        <span class=\"keyword\">else:</span>
            messages.error(request,
                'Please fix the errors below')
    <span class=\"keyword\">else:</span>
        <span class=\"comment\"># GET: Create form with instance (pre-fills fields)</span>
        form = BookForm(instance=book)
    
    context = {
        'form': form,
        'page_title': f'Edit Book: {book.title}',
        'book': book
    }
    
    <span class=\"keyword\">return</span> render(request, 'myapp/book_form.html', context)</code></pre></div>

                <div class="code-description">
                    <strong>üîë Key Difference:</strong>
                    <ul>
                        <li><strong>Create:</strong> <code>BookForm(request.POST)</code> - Creates new object</li>
                        <li><strong>Edit:</strong> <code>BookForm(request.POST, instance=book)</code> - Updates existing object</li>
                        <li>Same form handles both operations!</li>
                        <li>Same template works for create and edit!</li>
                    </ul>
                </div>

                <h3>Delete Book</h3>

                <div class="code-title">myapp/views.py - delete_book</div>
                <div class="code-block"><pre><code><span class="keyword">def</span> delete_book(request, pk):
    <span class="comment">"""
    GET: Show confirmation page
    POST: Actually delete the book
    """</span>
    
    book = get_object_or_404(Book, pk=pk)
    
    <span class="keyword">if</span> request.method == 'POST':
        book_title = book.title
        book.delete()  <span class=\"comment\"># Remove from database</span>
        
        messages.success(request,
            f'Book \"{book_title}\" deleted successfully!')
        <span class=\"keyword\">return</span> redirect('myapp:book_list')
    
    <span class=\"keyword\">return</span> render(request,
        'myapp/book_confirm_delete.html',
        {'book': book})</code></pre></div>
            </section>

            <!-- VALIDATION SECTION -->
            <section id="validation">
                <h2>‚úîÔ∏è Backend Validation Explained</h2>

                <h3>Validation Levels</h3>

                <table>
                    <tr>
                        <th>Level</th>
                        <th>Purpose</th>
                        <th>Example</th>
                        <th>When</th>
                    </tr>
                    <tr>
                        <td><strong>Field Type</strong></td>
                        <td>Basic data type check</td>
                        <td>IntegerField won't accept "abc"</td>
                        <td>Automatic</td>
                    </tr>
                    <tr>
                        <td><strong>Widget</strong></td>
                        <td>HTML input validation</td>
                        <td>DateInput only accepts dates</td>
                        <td>Browser + Backend</td>
                    </tr>
                    <tr>
                        <td><strong>Field-level</strong></td>
                        <td>Single field rules</td>
                        <td>ISBN exactly 13 digits</td>
                        <td>clean_fieldname()</td>
                    </tr>
                    <tr>
                        <td><strong>Form-level</strong></td>
                        <td>Multiple field rules</td>
                        <td>Title and author both required</td>
                        <td>clean()</td>
                    </tr>
                </table>

                <h3>Why Validation Matters</h3>

                <div class="important-box">
                    <strong>‚ö†Ô∏è Never trust browser validation!</strong>
                    <ul>
                        <li>Users can disable JavaScript</li>
                        <li>Users can modify HTML in browser</li>
                        <li>Attackers can send direct API requests</li>
                        <li>Always validate on backend (server)</li>
                    </ul>
                </div>

                <div class="success-box">
                    <strong>‚úÖ Django Form Validation Flow:</strong>
                    <ol>
                        <li>Browser sends POST request with form data</li>
                        <li>Django creates form instance with data</li>
                        <li><code>form.is_valid()</code> runs ALL validation</li>
                        <li>If invalid, errors stored in <code>form.errors</code></li>
                        <li>Template displays errors next to failed fields</li>
                        <li>User fixes and resubmits</li>
                    </ol>
                </div>
            </section>

            <!-- TEMPLATES SECTION -->
            <section id="templates">
                <h2>üé® Frontend: Templates with Form Validation</h2>

                <div class="template-box">
                    <strong>üìÑ Template Role in Phase 2:</strong> Templates now display form fields and errors dynamically. Django handles error rendering automatically.
                </div>

                <h3>Template 1: book_form.html - Form with Error Display</h3>

                <div class="code-title">templates/myapp/book_form.html - Enhanced Form Template</div>
                <div class="code-block"><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;{{ page_title }}&lt;/title&gt;
    &lt;style&gt;
        .form-group { margin-bottom: 20px; }
        .form-group label { font-weight: bold; display: block; margin-bottom: 5px; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; }
        .error-message { color: red; font-size: 0.9em; margin-top: 5px; }
        .form-errors { background: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; margin-bottom: 20px; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;{{ page_title }}&lt;/h1&gt;
    
    <span class=\"comment\">&lt;!-- Display all non-field errors --&gt;</span>
    {% if form.non_field_errors %}
        &lt;div class="form-errors"&gt;
            {% for error in form.non_field_errors %}
                &lt;p&gt;&lt;strong&gt;Error:&lt;/strong&gt; {{ error }}&lt;/p&gt;
            {% endfor %}
        &lt;/div&gt;
    {% endif %}
    
    <span class=\"comment\">&lt;!-- Form begins --&gt;</span>
    &lt;form method="POST"&gt;
        <span class=\"comment\">&lt;!-- CSRF Protection Token --&gt;</span>
        {% csrf_token %}
        
        <span class=\"comment\">&lt;!-- Render each form field --&gt;</span>
        {% for field in form %}
            &lt;div class="form-group"&gt;
                <span class=\"comment\">&lt;!-- Field label --&gt;</span>
                {{ field.label_tag }}
                
                <span class=\"comment\">&lt;!-- Add error highlighting if field has errors --&gt;</span>
                {% if field.errors %}
                    {{ field }}
                    <span class=\"comment\">&lt;!-- Display field-specific errors --&gt;</span>
                    &lt;div class="error-message"&gt;
                        {% for error in field.errors %}
                            ‚ùå {{ error }}
                        {% endfor %}
                    &lt;/div&gt;
                {% else %}
                    {{ field }}
                {% endif %}
            &lt;/div&gt;
        {% endfor %}
        
        <span class=\"comment\">&lt;!-- Submit button --&gt;</span>
        &lt;button type="submit"&gt;
            {% if book %}Update Book{% else %}Add Book{% endif %}
        &lt;/button&gt;
        &lt;a href="{% url 'myapp:book_list' %}"&gt;Cancel&lt;/a&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>

                <div class="code-description">
                    <strong>üìã Form Template Features:</strong>
                    <ul>
                        <li><code>{% csrf_token %}</code> - Required for POST forms (security)</li>
                        <li><code>{% for field in form %}</code> - Iterate all form fields</li>
                        <li><code>{{ field }}</code> - Renders HTML input element</li>
                        <li><code>field.errors</code> - Display validation errors</li>
                        <li><code>field.label_tag</code> - Renders &lt;label&gt; element</li>
                        <li><code>form.non_field_errors</code> - Form-level errors</li>
                    </ul>
                </div>

                <div class="backend-flow">
                    <strong>Backend Integration:</strong>
                    <ul>
                        <li>View sends <code>form</code> object to template</li>
                        <li>Template accesses <code>form.errors</code> (populated by Django)</li>
                        <li>Errors automatically display next to failed field</li>
                        <li>User sees exactly what needs fixing</li>
                    </ul>
                </div>

                <h3>Template 2: book_list.html - With Edit Links</h3>

                <div class="code-title">templates/myapp/book_list.html - List with Actions</div>
                <div class="code-block"><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;All Books&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;üìö Library Books&lt;/h1&gt;
    
    &lt;a href="{% url 'myapp:create_book' %}"&gt;‚ûï Add New Book&lt;/a&gt;
    
    {% if books %}
        &lt;table border="1"&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;Title&lt;/th&gt;
                    &lt;th&gt;Author&lt;/th&gt;
                    &lt;th&gt;ISBN&lt;/th&gt;
                    &lt;th&gt;Qty&lt;/th&gt;
                    &lt;th&gt;Actions&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                {% for book in books %}
                    &lt;tr&gt;
                        &lt;td&gt;
                            <span class=\"comment\">&lt;!-- Link to detail page --&gt;</span>
                            &lt;a href="{% url 'myapp:book_detail' pk=book.id %}"&gt;
                                {{ book.title }}
                            &lt;/a&gt;
                        &lt;/td&gt;
                        &lt;td&gt;{{ book.author }}&lt;/td&gt;
                        &lt;td&gt;{{ book.isbn }}&lt;/td&gt;
                        &lt;td&gt;{{ book.quantity }}&lt;/td&gt;
                        &lt;td&gt;
                            <span class=\"comment\">&lt;!-- Edit link uses {% url %} --&gt;</span>
                            &lt;a href="{% url 'myapp:edit_book' pk=book.id %}"&gt;‚úèÔ∏è Edit&lt;/a&gt;
                            &lt;a href="{% url 'myapp:delete_book' pk=book.id %}"&gt;üóëÔ∏è Delete&lt;/a&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                {% endfor %}
            &lt;/tbody&gt;
        &lt;/table&gt;
    {% else %}
        &lt;p&gt;No books found. &lt;a href="{% url 'myapp:create_book' %}"&gt;Add one!&lt;/a&gt;&lt;/p&gt;
    {% endif %}
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>

                <h3>Template 3: book_confirm_delete.html - Deletion Confirmation</h3>

                <div class="code-title">templates/myapp/book_confirm_delete.html - Safe Deletion</div>
                <div class="code-block"><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Delete Book&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;‚ö†Ô∏è Confirm Deletion&lt;/h2&gt;
    
    &lt;p&gt;Are you sure you want to delete:&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;"{{ book.title }}" by {{ book.author }}&lt;/strong&gt;&lt;/p&gt;
    
    <span class=\"comment\">&lt;!-- Deletion form (POST, not GET) --&gt;</span>
    &lt;form method="POST"&gt;
        {% csrf_token %}
        
        &lt;button type="submit" style="background: red; color: white;"&gt;
            Yes, Delete It
        &lt;/button&gt;
        
        <span class=\"comment\">&lt;!-- Cancel button --&gt;</span>
        &lt;a href="{% url 'myapp:book_detail' pk=book.id %}"&gt;
            No, Go Back
        &lt;/a&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>
            </section>

            <!-- DATA FLOW SECTION -->
            <section id="data-flow">
                <h2>üîÑ Phase 2 Data Flow with Form Validation</h2>

                <div class="flow-diagram">
COMPLETE PHASE 2 VALIDATION FLOW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

User submits form
        ‚Üì
Browser sends POST request with form data
        ‚Üì
Django view receives request: create_book(request)
        ‚Üì
Create form instance: form = BookForm(request.POST)
        ‚Üì
Call form.is_valid()
        ‚Üì
Django runs validation:
   1. Field type validation (CharField, IntegerField, etc.)
   2. Widget validation (date, number inputs)
   3. clean_fieldname() for each field
   4. clean() for form-level validation
        ‚Üì
IF VALID:
   ‚Üí form.save() ‚Üí INSERT/UPDATE database
   ‚Üí Show success message
   ‚Üí Redirect to list
        ‚Üì
IF INVALID:
   ‚Üí form.errors populated with error messages
   ‚Üí Render template with form and errors
   ‚Üí User sees exactly what went wrong
   ‚Üí Same form shown with previous data intact
   ‚Üí User fixes and resubmits
                </div>

                <div class="important-box">
                    <strong>üîí Security Benefits in Phase 2:</strong>
                    <ul>
                        <li>CSRF token prevents malicious form submissions</li>
                        <li>Type validation prevents invalid data in database</li>
                        <li>Uniqueness checks prevent duplicates</li>
                        <li>Length validation prevents overflow attacks</li>
                        <li>Input sanitization prevents SQL injection</li>
                    </ul>
                </div>
            </section>

            <!-- COMMANDS SECTION -->
            <section id="commands">
                <h2>‚öôÔ∏è Phase 2 Setup Commands</h2>

                <div class="step-box">
                    <span class="step-number">1</span>
                    <strong>Create forms.py</strong>
                </div>

                <div class="code-description">
                    Create <code>myapp/forms.py</code> with BookForm (ModelForm)
                </div>

                <div class="step-box">
                    <span class="step-number">2</span>
                    <strong>Update views.py</strong>
                </div>

                <div class="code-description">
                    Modify views to use BookForm instead of manual request.POST handling
                </div>

                <div class="step-box">
                    <span class="step-number">3</span>
                    <strong>Update Templates</strong>
                </div>

                <div class="code-description">
                    Update book_form.html to render form fields and display errors
                </div>

                <div class="step-box">
                    <span class="step-number">4</span>
                    <strong>Run Development Server</strong>
                </div>

                <div class="terminal-command">python manage.py runserver</div>

                <div class="code-description">
                    <strong>Test at:</strong> http://127.0.0.1:8000/books/
                </div>
            </section>

            <!-- TESTING SECTION -->
            <section id="testing">
                <h2>‚úÖ Phase 2 Testing Procedures</h2>

                <div class="step-box">
                    <span class="step-number">1</span>
                    <strong>Test Valid Form Submission</strong>
                    <ol>
                        <li>Visit /add-book/</li>
                        <li>Fill ALL fields correctly</li>
                        <li>Submit form</li>
                        <li>Verify book added and list shows new book</li>
                    </ol>
                </div>

                <div class="step-box">
                    <span class="step-number">2</span>
                    <strong>Test Invalid Inputs</strong>
                    <ol>
                        <li>Try empty title ‚Üí Error: "Title is required!"</li>
                        <li>Try "abc" for ISBN ‚Üí Error: "ISBN must be 13 digits"</li>
                        <li>Try 0 for quantity ‚Üí Error: "Must be at least 1"</li>
                        <li>Try duplicate ISBN ‚Üí Error: "ISBN already registered"</li>
                        <li>Verify errors display next to failed fields</li>
                    </ol>
                </div>

                <div class="step-box">
                    <span class="step-number">3</span>
                    <strong>Test Edit Form Pre-filling</strong>
                    <ol>
                        <li>Go to /book/1/edit/</li>
                        <li>Verify all fields pre-filled with current data</li>
                        <li>Change one field</li>
                        <li>Submit</li>
                        <li>Verify only changed field updated in database</li>
                    </ol>
                </div>

                <div class="step-box">
                    <span class="step-number">4</span>
                    <strong>Test Duplicate Prevention</strong>
                    <ol>
                        <li>Add book with ISBN 1234567890123</li>
                        <li>Try adding another with same ISBN</li>
                        <li>Verify error: "This ISBN already registered"</li>
                        <li>Same for duplicate titles</li>
                    </ol>
                </div>

                <div class="success-box">
                    <strong>‚úÖ Phase 2 Complete When:</strong>
                    <ul>
                        <li>All form validation works correctly</li>
                        <li>Invalid data rejected with clear error messages</li>
                        <li>Edit forms pre-fill with current data</li>
                        <li>Duplicate prevention working</li>
                        <li>Form errors display next to failed fields</li>
                        <li>CSRF protection active (token in forms)</li>
                    </ul>
                </div>
            </section>

            <!-- COMPARISON SECTION -->
            <section id="comparison">
                <h2>üìä Phase 1 vs Phase 2 Comparison</h2>

                <table>
                    <tr>
                        <th>Feature</th>
                        <th>Phase 1 (Manual)</th>
                        <th>Phase 2 (ModelForm)</th>
                    </tr>
                    <tr>
                        <td><strong>Form Creation</strong></td>
                        <td>Manual HTML in template</td>
                        <td>Auto-generated from model</td>
                    </tr>
                    <tr>
                        <td><strong>Data Extraction</strong></td>
                        <td>request.POST.get('field')</td>
                        <td>form.cleaned_data['field']</td>
                    </tr>
                    <tr>
                        <td><strong>Validation</strong></td>
                        <td>Manual if/else checks</td>
                        <td>Automatic validation methods</td>
                    </tr>
                    <tr>
                        <td><strong>Error Display</strong></td>
                        <td>Manual error messages</td>
                        <td>Automatic form.errors</td>
                    </tr>
                    <tr>
                        <td><strong>CSRF Protection</strong></td>
                        <td>Manual token handling</td>
                        <td>Automatic token in form</td>
                    </tr>
                    <tr>
                        <td><strong>Create/Edit Forms</strong></td>
                        <td>Two separate views</td>
                        <td>Same form for both</td>
                    </tr>
                    <tr>
                        <td><strong>Code Lines</strong></td>
                        <td>~50 lines per form</td>
                        <td>~20 lines per form</td>
                    </tr>
                </table>
            </section>
        </div>

        <footer>
            <p>üìù <strong>Library Management System - Phase 2 (Updated)</strong></p>
            <p>Enhanced Form Handling with Complete Backend Integration</p>
            <p>¬© 2025 | November 17, 2025</p>
        </footer>
    </div>

    <script>
        document.querySelectorAll('.terminal-command').forEach(cmd => {
            cmd.addEventListener('click', function() {
                const text = this.innerText;
                navigator.clipboard.writeText(text).then(() => {
                    const originalText = this.innerText;
                    this.innerText = '‚úÖ Copied!';
                    setTimeout(() => {
                        this.innerText = originalText;
                    }, 2000);
                });
            });
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>
